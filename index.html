<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Hericium's Dream(猴头菇的梦境)</title>
        <style>
            * {
                padding: 0;
                margin: 0;
            }
            html,body {
                width: 100%;
                height: 100%;
            }
            #input {
                width: 66%;
                height: 5%;
                position: absolute;
                bottom: 1%;
                left: 1%;
                font-size: 1.5em;
            }
            #send {
                width: 15%;
                height: 5%;
                position: absolute;
                bottom: 1%;
                left: 68%;
                font-size: 1.5em;
            }
            #collect {
                width: 15%;
                height: 5%;
                position: absolute;
                bottom: 1%;
                left: 84%;
                font-size: 1.5em;
            }
            #log {
                width: 95%;
                height: 85%;
                padding: 2.5%;
                overflow-x: hidden;
                overflow-y: auto;
            }
            #collectUI {
                position: absolute;
                top: 0;
                left: 0;
                width: 95%;
                height: 85%;
                padding: 2.5%;
                overflow-x: hidden;
                overflow-y: auto;
                background: black;
                opacity: 0.8;
                color: white;
                display: none;
                grid-template-columns: 1fr 1fr 1fr 1fr;
                column-gap: 5px;
            }
            #collectUI div {
                text-align: center;
                font-size: 1.5em;
            }
            #collectUI div img {
                width: 100%;
            }
            .profile {
                width: 48px;
                height: 48px;
                border-radius: 8px;
            }
            .name {
                position: relative;
                top: -16px;
                left: 4px;
                font-size: 16px;
                color: gray;
                font-size: 1.5em;
            }
            .chat {
                width: 45%;
                padding: 2.5%;
                border-radius: 24px;
                background: #0C8;
                color: white;
                word-break: break-word;
                font-size: 1.5em;
            }
            .own {
                text-align: right;
                margin: 5% 0 0 0;
            }
            .own .chat {
                position: relative;
                left: 50%;
                background: #08C;
            }
            #start {
                width: 100%;
                height: 100%;
                background: green;
                position: absolute;
                top: 0;
                left: 0;
                font-size: 2.5em;
            }
            #start div {
                color: white;
                position: absolute;
                top: 70%;
                width: 100%;
                text-align: center;
            }
            .narration {
                margin:5%;
                color: white;
                text-align: center;
            }
            .other {
                margin: 5% 0 0 0;
            }
        </style>
    </head>
    <body>
        <div id="log">
        </div>
        <div id="collectUI">
            <div>
                <img src="test" />
                test
            </div>
        </div>
        <select id="input">
            
        </select>
        <input type="button" id="send" value="发送" onclick="send()" />
        <input type="button" id="collect" value="收集" onclick="collect()" />
        <div id="start" onclick="start()">
            封面
            <div>点击屏幕开始游戏</div>
            <span style="position: absolute;bottom: 1%;left: 1%;color: white;">
                Beta 0.1.0<br/>
                有 Bug 请反馈至 studios_air@163.com
            </span>
        </div>
        <audio id="ring">
            <source src="./assets/audio/ring.mp3" type="audio/mpeg" />
        </audio>
        <audio id="ring2">
            <source src="./assets/audio/ring2.mp3" type="audio/mpeg" />
        </audio>
        <audio id="ring3">
            <source src="./assets/audio/ring3.mp3" type="audio/mpeg" />
        </audio>
        <script src="./opera.js"></script>
        <script>
            var startBox = undefined;
            var _opera = 0;
            collect = () => {
                if(document.getElementById("collectUI").style.display == "grid")document.getElementById("collectUI").style.display = "none";
                else document.getElementById("collectUI").style.display = "grid";
            }
            talk = (next) => {
                localStorage.log = document.getElementById("log").innerHTML;
                localStorage.opera = _opera.toString();
                if(!opera[_opera])return undefined;
                var res = opera[_opera];
                if(res.type == "other"){
                    document.getElementById("log").innerHTML += `
                        <div class="other">
                            <img src="${res.profile}" class="profile" />
                            <span class="name">${res.name}</span>
                            <div class="chat">${res.chat}</div>
                        </div>`;
                    setTimeout(()=>{
                        if(res.jmp)_opera += res.jmp;
                        else _opera++;
                        talk();
                    },res.chat.length * 200);
                    document.getElementById("ring").play();
                }
                else if(res.type == "narration"){
                    console.log(res)
                    document.getElementById("log").innerHTML += `
                        <div class="narration">
                            <span style="background: gray;padding: 1% 5%;border-radius: 16px;font-size: 1.25em;">${res.inner}</span>
                        </div>`;
                    setTimeout(()=>{    
                        if(res.jmp)_opera += res.jmp;
                        else _opera++;
                        talk();
                    },res.inner.length * 200);
                    document.getElementById("ring3").play();
                }
                else if(res.type == "own"){
                    console.log(res)
                    document.getElementById("log").innerHTML += `
                        <div class="own">
                            <img src="${res.profile}" class="profile" />
                            <span class="name">${res.name}</span>
                            <div class="chat">${res.chat}</div>
                        </div>`;
                    setTimeout(()=>{    
                        if(res.jmp)_opera += res.jmp;
                        else _opera++;
                        talk();
                    },res.chat.length * 200);
                    document.getElementById("ring").play();
                }
                else if(res.type == "img"){
                    document.getElementById("log").innerHTML += `<img src="${res.url}" style="margin: 5% 25% 0 25%;width: 50%;" />`;
                    setTimeout(()=>{    
                        if(res.jmp)_opera += res.jmp;
                        else _opera++;
                        talk();
                    },3000);
                    document.getElementById("ring").play();
                }
                else if(res.type == "video"){
                    document.getElementById("log").innerHTML += `<video style="width: 50%;margin: 5% 25% 0 25%;" controls="controls" autoplay="autoplay">
                            <source src="${res.url}" type="video/mp4" />
                        </video>`;
                    setTimeout(()=>{    
                        if(res.jmp)_opera += res.jmp;
                        else _opera++;
                        talk();
                    },3000);
                    document.getElementById("ring").play();
                }
                else if(res.type == "opt"){
                    res.opt.forEach(item => {
                        document.getElementById("input").innerHTML += `<option value="${(item.jmp)?item.jmp:"1"}">${item.inner}</option>`
                    });
                    document.getElementById("ring2").play();
                }
                document.getElementById("log").scrollBy(0,999999)
            }
            send = () => {
                _opera += Number(document.getElementById("input").value);
                talk();
                document.getElementById("input").innerHTML = "";
            }
            start = () => {
                var o = 100;
                if(startBox == undefined){
                    startBox = setInterval(()=>{
                        o--;
                        document.getElementById("start").style.opacity = o / 100;
                        if(o <= 0){
                            clearInterval(startBox);
                            startBox = undefined;
                            document.getElementById("start").style.display = "none";
                            setTimeout(()=>{
                                if(localStorage.opera && confirm("您有一个游戏进度，是否加载\n（如果不加载，则旧进度会被新进度覆盖）")){
                                    document.getElementById("log").innerHTML = localStorage.log;
                                    _opera = Number(localStorage.opera);
                                }
                                talk();
                            },1000);
                        }
                    },10);
                }
            }
        </script>
    </body>
</html>